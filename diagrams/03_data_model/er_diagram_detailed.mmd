```mermaid
erDiagram
    USER {
        int user_id PK "AUTO_INCREMENT"
        varchar email UK "UNIQUE, NOT NULL"
        varchar password_hash "NOT NULL, bcrypt"
        varchar name "NOT NULL, 2-50 chars"
        timestamp created_at "NOT NULL, DEFAULT NOW()"
        timestamp updated_at "NOT NULL, DEFAULT NOW()"
        timestamp last_login "NULL"
        boolean email_verified "DEFAULT FALSE"
        varchar email_verification_token "NULL"
        varchar password_reset_token "NULL"
        timestamp password_reset_expires "NULL"
    }
    
    HOME {
        int home_id PK "AUTO_INCREMENT"
        varchar name "NOT NULL, 1-100 chars"
        varchar description "NULL, TEXT"
        varchar address "NULL, 255 chars"
        varchar timezone "DEFAULT 'UTC'"
        timestamp created_at "NOT NULL, DEFAULT NOW()"
        timestamp updated_at "NOT NULL, DEFAULT NOW()"
        int created_by_user_id FK "NOT NULL"
    }
    
    USER_HOME {
        int user_home_id PK "AUTO_INCREMENT"
        int user_id FK "NOT NULL"
        int home_id FK "NOT NULL"
        enum role "owner, member, guest"
        timestamp added_at "NOT NULL, DEFAULT NOW()"
        timestamp last_accessed "NULL"
        boolean is_active "DEFAULT TRUE"
    }
    
    ICON {
        int icon_id PK "AUTO_INCREMENT"
        varchar icon_name UK "UNIQUE, NOT NULL"
        varchar icon_url "NOT NULL, 255 chars"
        varchar category "NOT NULL, 50 chars"
        varchar description "NULL, 255 chars"
        boolean is_active "DEFAULT TRUE"
    }
    
    ROOM {
        int room_id PK "AUTO_INCREMENT"
        int home_id FK "NOT NULL"
        varchar name "NOT NULL, 1-100 chars"
        enum type "bedroom, living_room, kitchen, bathroom, office, other"
        int icon_id FK "NOT NULL"
        varchar description "NULL, TEXT"
        timestamp created_at "NOT NULL, DEFAULT NOW()"
        timestamp updated_at "NOT NULL, DEFAULT NOW()"
        int sort_order "DEFAULT 0"
    }
    
    DEVICE_MODEL {
        int model_id PK "AUTO_INCREMENT"
        varchar model_name UK "UNIQUE, NOT NULL"
        enum device_type "light_bulb, smart_socket, sensor, switch"
        json capabilities "NOT NULL"
        text description "NULL"
        varchar manufacturer "NOT NULL, 100 chars"
        varchar firmware_version "NULL, 50 chars"
        json default_settings "NULL"
        boolean is_active "DEFAULT TRUE"
    }
    
    DEVICE {
        int device_id PK "AUTO_INCREMENT"
        char device_code UK "UNIQUE, NOT NULL, 12 digits"
        int model_id FK "NOT NULL"
        int home_id FK "NOT NULL"
        int room_id FK "NULL"
        varchar custom_name "NULL, 1-100 chars"
        enum status "on, off, unavailable"
        boolean energy_saving_mode "DEFAULT FALSE"
        json settings "NULL"
        timestamp added_at "NOT NULL, DEFAULT NOW()"
        timestamp last_seen "NULL"
        timestamp last_command "NULL"
        varchar firmware_version "NULL, 50 chars"
        json metadata "NULL"
    }
    
    SCENARIO {
        int scenario_id PK "AUTO_INCREMENT"
        int home_id FK "NOT NULL"
        varchar name "NOT NULL, 1-100 chars"
        text description "NULL"
        boolean is_active "DEFAULT TRUE"
        timestamp created_at "NOT NULL, DEFAULT NOW()"
        timestamp updated_at "NOT NULL, DEFAULT NOW()"
        int created_by_user_id FK "NOT NULL"
        timestamp last_executed "NULL"
    }
    
    SCENARIO_SCHEDULE {
        int schedule_id PK "AUTO_INCREMENT"
        int scenario_id FK "NOT NULL"
        boolean monday "DEFAULT FALSE"
        boolean tuesday "DEFAULT FALSE"
        boolean wednesday "DEFAULT FALSE"
        boolean thursday "DEFAULT FALSE"
        boolean friday "DEFAULT FALSE"
        boolean saturday "DEFAULT FALSE"
        boolean sunday "DEFAULT FALSE"
        time start_time "NOT NULL"
        time end_time "NOT NULL"
        timestamp created_at "NOT NULL, DEFAULT NOW()"
        timestamp updated_at "NOT NULL, DEFAULT NOW()"
        boolean is_active "DEFAULT TRUE"
    }
    
    SCENARIO_ACTION {
        int action_id PK "AUTO_INCREMENT"
        int scenario_id FK "NOT NULL"
        int device_id FK "NOT NULL"
        enum action_type "turn_on, turn_off, set_brightness, set_color, set_energy_saving"
        json action_params "NULL"
        int execution_order "NOT NULL"
        timestamp created_at "NOT NULL, DEFAULT NOW()"
        timestamp updated_at "NOT NULL, DEFAULT NOW()"
    }
    
    %% Связи с детальными ограничениями
    USER ||--o{ USER_HOME : "имеет доступ к"
    HOME ||--o{ USER_HOME : "содержит пользователей"
    HOME ||--o{ ROOM : "содержит"
    ICON ||--o{ ROOM : "используется в"
    HOME ||--o{ DEVICE : "содержит"
    ROOM ||--o{ DEVICE : "содержит"
    DEVICE_MODEL ||--o{ DEVICE : "является моделью"
    HOME ||--o{ SCENARIO : "содержит"
    SCENARIO ||--o{ SCENARIO_SCHEDULE : "имеет расписание"
    SCENARIO ||--o{ SCENARIO_ACTION : "выполняет действия"
    DEVICE ||--o{ SCENARIO_ACTION : "участвует в действиях"
    USER ||--o{ HOME : "создает"
    USER ||--o{ SCENARIO : "создает"
```
