# Полная карта пользовательских историй (User Story Map)

## Контекст

Полная карта пользовательских историй для приложения Stets Home разработана на основе всех интервью с заказчиком и пользователями. Включает все активности, пользовательские задачи и истории с разделением на MVP и будущие версии.

## Персоны пользователей

### Михаил (Новичок)
- **Возраст:** 30 лет, IT-специалист
- **Опыт:** Новичок в умном доме, боится сложности
- **Цель:** Простое управление освещением, энергосбережение

### Алёна (Эксперт)
- **Возраст:** 35 лет, фитнес-тренер
- **Опыт:** Продвинутый пользователь умного дома
- **Цель:** Автоматизация, удобное управление множеством устройств

---

## ЭПИК 1: Онбординг и аутентификация

### Активность: Первое знакомство с приложением

**Пользовательские задачи:**
- Зарегистрироваться в приложении
- Получить автоматически созданный дом
- Войти в приложение

#### US-001: Регистрация нового пользователя [MVP]
- **Как** новый пользователь
- **Я хочу** зарегистрироваться в приложении
- **Чтобы** получить доступ к управлению умным домом

**Gherkin-сценарий:**
```gherkin
Scenario: Успешная регистрация
  Given пользователь открыл приложение впервые
  When он нажимает "Зарегистрироваться"
  And вводит валидный email "user@example.com"
  And вводит пароль "Password123"
  And вводит имя "Михаил"
  And нажимает "Создать аккаунт"
  Then создается учетная запись пользователя
  And автоматически создается дом "Мой дом"
  And пользователь попадает на главный экран

Scenario: Регистрация с невалидным паролем
  Given пользователь открыл приложение впервые
  When он вводит пароль "123"
  Then отображается ошибка "Пароль должен содержать 8-16 символов, включая строчные и прописные буквы"
```

**Критерии приемки:**
- Пользователь может ввести email, пароль и имя
- Система валидирует формат email
- Пароль должен содержать 8-16 символов, минимум 1 строчную и 1 прописную букву латиницы
- Email уникален в системе
- После успешной регистрации создается учетная запись
- Автоматически создается дом "Мой дом"
- Пользователь перенаправляется на главный экран

**Примеры:**
- ✅ Валидные данные: email="mikhail@email.com", пароль="MyPass123", имя="Михаил"
- ❌ Невалидный пароль: "123", "mypassword", "MYPASSWORD"
- ❌ Дубликат email: регистрация с уже существующим email

**Примечания:**
- Email используется как логин
- Пароль хэшируется перед сохранением
- Валидация происходит на клиенте и сервере

#### US-002: Автосоздание первого дома [MVP]
- **Как** новый пользователь
- **Я хочу** чтобы первый дом создался автоматически
- **Чтобы** сразу начать добавлять устройства без дополнительных настроек

**Gherkin-сценарий:**
```gherkin
Scenario: Автосоздание дома при регистрации
  Given пользователь успешно зарегистрировался
  When система обрабатывает регистрацию
  Then автоматически создается дом с названием "Мой дом"
  And пользователь становится владельцем этого дома
  And дом отображается на главном экране
```

**Критерии приемки:**
- Дом создается автоматически после успешной регистрации
- Название дома по умолчанию - "Мой дом"
- Пользователь становится владельцем дома (роль "owner")
- Дом сразу отображается на главном экране
- Не требуется дополнительных действий пользователя

**Примеры:**
- ✅ После регистрации сразу виден дом "Мой дом" на главном экране
- ✅ Пользователь может сразу начать добавлять устройства
- ✅ Не отображается окно создания дома

**Примечания:**
- Это снижает порог входа для новых пользователей
- Название дома можно будет изменить позже
- Поддержка нескольких домов заложена в структуру данных

#### US-003: Вход в приложение [MVP]
- **Как** зарегистрированный пользователь
- **Я хочу** войти в приложение
- **Чтобы** получить доступ к своему умному дому

**Gherkin-сценарий:**
```gherkin
Scenario: Успешный вход
  Given пользователь зарегистрирован в системе
  When он вводит email "user@example.com"
  And вводит пароль "Password123"
  And нажимает "Войти"
  Then пользователь успешно авторизуется
  And отображается главный экран с его домами
```

**Критерии приемки:**
- Пользователь может войти с email и паролем
- Система проверяет существование пользователя
- Система проверяет корректность пароля
- При успешной авторизации создается сессия
- Отображается главный экран с домами пользователя
- При неверных данных показывается ошибка

**Примеры:**
- ✅ Успешный вход: email="mikhail@email.com", пароль="MyPass123"
- ❌ Неверный email: "wrong@email.com"
- ❌ Неверный пароль: "wrongpassword"
- ❌ Пользователь не существует

**Примечания:**
- Сессия сохраняется для последующих входов
- После 5 неудачных попыток вход блокируется на 15 минут

### Активность: Управление учетной записью

**Пользовательские задачи:**
- Восстановить пароль
- Изменить email
- Выйти из приложения
- Авторизоваться через сторонние сервисы (будущая версия)

#### US-004: Восстановление пароля [MVP]
- **Как** пользователь, забывший пароль
- **Я хочу** восстановить доступ к аккаунту
- **Чтобы** не потерять настройки умного дома

**Gherkin-сценарий:**
```gherkin
Scenario: Восстановление пароля
  Given пользователь на экране входа
  When он нажимает "Забыли пароль?"
  And вводит email "user@example.com"
  And нажимает "Отправить"
  Then на email отправляется ссылка для сброса пароля
  And отображается сообщение "Проверьте почту"
```

**Критерии приемки:**
- Пользователь может запросить восстановление пароля
- Система проверяет существование email в базе
- На email отправляется уникальная ссылка для сброса
- Ссылка действительна в течение 24 часов
- Пользователь видит подтверждение отправки письма
- Возможность установить новый пароль через ссылку

**Примеры:**
- ✅ Запрос на существующий email: отправка письма
- ❌ Запрос на несуществующий email: не раскрывать, что email не найден
- ❌ Истечение срока действия ссылки: требуется новый запрос

**Примечания:**
- Защита от спама: не более 3 запросов в час с одного IP
- Ссылка одноразовая, после использования становится недействительной

#### US-005: Изменение email [MVP]
- **Как** пользователь
- **Я хочу** изменить email в профиле
- **Чтобы** использовать актуальный адрес для уведомлений

**Gherkin-сценарий:**
```gherkin
Scenario: Изменение email
  Given пользователь авторизован в приложении
  When он переходит в "Профиль" → "Настройки"
  And нажимает "Изменить email"
  And вводит новый email "newemail@example.com"
  And подтверждает изменение
  Then email успешно обновляется
  And на новый email отправляется подтверждение
```

**Критерии приемки:**
- Пользователь может изменить email в настройках
- Система проверяет валидность формата нового email
- Новый email должен быть уникальным в системе
- На новый email отправляется подтверждение
- Старый email остается активным до подтверждения нового

**Примеры:**
- ✅ Изменение на валидный уникальный email
- ❌ Попытка изменить на уже существующий email
- ❌ Невалидный формат email

**Примечания:**
- Требуется подтверждение пароля для смены email
- Email используется для входа, важно подтверждение

#### US-006: Выход из приложения [MVP]
- **Как** пользователь
- **Я хочу** выйти из приложения
- **Чтобы** защитить свои данные при использовании чужого устройства

**Gherkin-сценарий:**
```gherkin
Scenario: Выход из приложения
  Given пользователь авторизован в приложении
  When он переходит в "Профиль"
  And нажимает "Выйти"
  Then пользователь разлогинивается
  And отображается экран входа
```

**Критерии приемки:**
- Пользователь может выйти из аккаунта
- Сессия завершается после выхода
- Все данные сессии удаляются локально
- Отображается экран входа
- Для доступа к приложению требуется повторная авторизация

**Примеры:**
- ✅ Выход из профиля: возврат на экран входа
- ✅ Повторный вход требует авторизацию

**Примечания:**
- Все локальные кеши очищаются при выходе
- Токены доступа становятся недействительными

#### US-040: Авторизация через Google [NOT MVP]
- **Как** пользователь
- **Я хочу** войти через аккаунт Google
- **Чтобы** быстро войти без пароля

#### US-041: Авторизация через Яндекс [NOT MVP]
- **Как** пользователь
- **Я хочу** войти через аккаунт Яндекс
- **Чтобы** быстро войти без пароля

---

## ЭПИК 2: Организация умного дома

### Активность: Настройка структуры дома

**Пользовательские задачи:**
- Создать комнаты в доме
- Редактировать комнаты
- Удалить комнаты
- Переключиться между домами

#### US-007: Создание комнат [MVP]
- **Как** пользователь
- **Я хочу** создавать комнаты в доме
- **Чтобы** организовать устройства по помещениям

**Gherkin-сценарий:**
```gherkin
Scenario: Создание новой комнаты
  Given пользователь на главном экране дома
  When он нажимает "Добавить комнату"
  And выбирает тип "Спальня"
  And вводит название "Главная спальня"
  And выбирает иконку "кровать"
  And нажимает "Создать"
  Then комната добавляется в список
  And отображается на главном экране

Scenario: Превышение лимита комнат
  Given в доме уже 10 комнат
  When пользователь пытается добавить 11-ю комнату
  Then отображается ошибка "Максимум 10 комнат на дом"
```

**Критерии приемки:**
- Пользователь может создать комнату с типом, названием и иконкой
- Максимум 10 комнат на дом
- Название комнаты обязательно для заполнения
- Доступны типы: living_room, bedroom, kitchen, bathroom, hallway, corridor, other
- Выбор иконки из предустановленного набора
- Комната появляется на главном экране

**Примеры:**
- ✅ Создание комнаты: тип="Спальня", название="Главная спальня", иконка="кровать"
- ❌ Превышение лимита: попытка создать 11-ю комнату
- ❌ Пустое название: ошибка валидации

**Примечания:**
- Комнаты не обязательны - можно работать без них
- Комнаты можно создавать до или после добавления устройств

#### US-008: Редактирование комнат [MVP]
- **Как** пользователь
- **Я хочу** изменять данные комнат
- **Чтобы** исправить ошибки или обновить информацию

**Gherkin-сценарий:**
```gherkin
Scenario: Редактирование комнаты
  Given пользователь видит список комнат
  When он нажимает на комнату "Спальня"
  And выбирает "Редактировать"
  And изменяет название на "Главная спальня"
  And изменяет тип на "Гостиная"
  And нажимает "Сохранить"
  Then изменения сохраняются
  And комната отображается с новыми данными
```

**Критерии приемки:**
- Пользователь может изменить название, тип и иконку комнаты
- Изменения сохраняются в базе данных
- Обновленная информация отображается немедленно
- Устройства в комнате не затронуты изменениями

**Примеры:**
- ✅ Изменение названия: "Спальня" → "Главная спальня"
- ✅ Изменение типа: bedroom → living_room
- ✅ Изменение иконки

**Примечания:**
- Все поля можно редактировать
- Требуется подтверждение сохранения

#### US-009: Удаление комнат [MVP]
- **Как** пользователь
- **Я хочу** удалять ненужные комнаты
- **Чтобы** поддерживать актуальную структуру дома

**Gherkin-сценарий:**
```gherkin
Scenario: Удаление пустой комнаты
  Given комната "Коридор" не содержит устройств
  When пользователь выбирает "Удалить комнату"
  And подтверждает удаление
  Then комната удаляется из списка

Scenario: Удаление комнаты с устройствами
  Given комната "Спальня" содержит устройства
  When пользователь пытается удалить комнату
  Then отображается предупреждение "В комнате есть устройства. Сначала переместите их в другие комнаты"
```

**Критерии приемки:**
- Пустая комната удаляется без предупреждения
- Комната с устройствами требует предупреждение
- Пользователь не может удалить комнату с устройствами
- Удаление требует подтверждения

**Примеры:**
- ✅ Удаление пустой комнаты: подтверждение → удаление
- ❌ Удаление комнаты с устройствами: предупреждение, удаление блокируется

**Примечания:**
- Защита от случайного удаления
- Требуется явное подтверждение

#### US-042: Переключение между домами [MVP]
- **Как** пользователь с несколькими домами
- **Я хочу** переключаться между домами
- **Чтобы** управлять разными умными домами

**Gherkin-сценарий:**
```gherkin
Scenario: Переключение между домами
  Given пользователь владеет 2 домами
  When он нажимает на название текущего дома
  And выбирает другой дом из списка
  Then отображается интерфейс выбранного дома
  And список комнат и устройств обновляется
```

**Критерии приемки:**
- Пользователь может переключаться между своими домами
- Максимум 10 домов на пользователя
- Отображается текущий активный дом в заголовке
- При переключении обновляются комнаты и устройства
- Состояние устройств синхронизируется

**Примеры:**
- ✅ Переключение между "Квартира" и "Дача"
- ✅ Отображение актуального списка устройств для выбранного дома

**Примечания:**
- Первый дом создается автоматически при регистрации
- Дополнительные дома создаются вручную (не в MVP)

### Активность: Подключение устройств

**Пользовательские задачи:**
- Добавить устройство через QR-код
- Добавить устройство вручную
- Предотвратить дубликаты устройств
- Привязать устройство к комнате
- Удалить устройство
- Изменить название устройства (будущая версия)

#### US-010: Добавление устройства через QR-код [MVP]
- **Как** пользователь
- **Я хочу** добавлять устройства сканированием QR-кода
- **Чтобы** быстро подключить новое устройство

**Gherkin-сценарий:**
```gherkin
Scenario: Успешное добавление через QR
  Given пользователь на экране "Добавить устройство"
  When он нажимает "Сканировать QR-код"
  And сканирует валидный QR-код "123456789012"
  Then устройство добавляется в дом
  And отображается в списке устройств
  And предлагается выбрать комнату

Scenario: Сканирование невалидного QR
  Given пользователь сканирует QR-код
  When QR-код содержит невалидный код "abc123"
  Then отображается ошибка "Неверный код устройства"
```

**Критерии приемки:**
- Пользователь может сканировать QR-код для добавления устройства
- QR-код содержит 12-значный цифровой код
- Система проверяет существование устройства в системе
- Максимум 100 устройств на дом
- После добавления предлагается выбрать комнату
- Устройство получает название по модели автоматически

**Примеры:**
- ✅ Успешное сканирование QR: код="123456789012"
- ❌ Невалидный QR-код: "abc123", "12345"
- ❌ Превышение лимита: попытка добавить 101-е устройство

**Примечания:**
- QR-код на упаковке устройства
- Автоматическое определение модели устройства

#### US-011: Добавление устройства вручную [MVP]
- **Как** пользователь
- **Я хочу** добавлять устройства вводом кода вручную
- **Чтобы** подключить устройство когда QR-код поврежден

**Gherkin-сценарий:**
```gherkin
Scenario: Добавление устройства вручную
  Given пользователь на экране "Добавить устройство"
  When он нажимает "Ввести код вручную"
  And вводит код "123456789012"
  And нажимает "Добавить"
  Then устройство добавляется в дом
  And отображается в списке устройств
```

**Критерии приемки:**
- Пользователь может ввести 12-значный код вручную
- Код валидируется на формат (только цифры, длина 12)
- Система проверяет существование устройства
- То же поведение что и при QR-сканировании

**Примеры:**
- ✅ Валидный код: "123456789012"
- ❌ Неверный формат: "abc123", "123456"
- ❌ Неверная длина: "12345"

**Примечания:**
- Код на упаковке устройства
- Важная функция для поврежденных QR-кодов (кошка играет с коробками)

#### US-012: Предотвращение дубликатов устройств [MVP]
- **Как** пользователь
- **Я хочу** чтобы система предотвращала добавление одного устройства дважды
- **Чтобы** избежать путаницы в управлении

**Gherkin-сценарий:**
```gherkin
Scenario: Попытка добавить существующее устройство
  Given устройство с кодом "123456789012" уже добавлено
  When пользователь пытается добавить устройство с тем же кодом
  Then отображается ошибка "Устройство уже добавлено в дом"
  And устройство не добавляется повторно
```

**Критерии приемки:**
- Система проверяет уникальность кода устройства в доме
- Попытка добавить существующее устройство блокируется
- Отображается понятное сообщение об ошибке
- Дубликаты не создаются

**Примеры:**
- ❌ Повторное добавление: "Устройство уже добавлено в дом"
- ✅ Уникальное устройство: добавление успешно

**Примечания:**
- Критично для пользователей (Александра дважды отсканировала)
- Проверка на уровне кода устройства

#### US-013: Привязка устройства к комнате [MVP]
- **Как** пользователь
- **Я хочу** привязывать устройства к комнатам
- **Чтобы** организовать управление по помещениям

**Gherkin-сценарий:**
```gherkin
Scenario: Привязка устройства к комнате
  Given устройство добавлено в дом
  When пользователь выбирает "Настроить устройство"
  And выбирает комнату "Спальня"
  And нажимает "Сохранить"
  Then устройство привязывается к комнате
  And отображается в списке устройств комнаты
```

**Критерии приемки:**
- Устройство можно привязать к комнате
- Выбор из списка существующих комнат
- Привязка опциональна (можно оставить без комнаты)
- Устройство отображается в комнате после привязки

**Примеры:**
- ✅ Привязка к комнате: устройство → "Спальня"
- ✅ Без привязки: устройство остается в "Моих устройствах"

**Примечания:**
- Комнаты не обязательны для работы с приложением
- Можно добавлять устройства до создания комнат

#### US-014: Удаление устройства [MVP]
- **Как** пользователь
- **Я хочу** удалять сломанные устройства
- **Чтобы** поддерживать актуальный список устройств

**Gherkin-сценарий:**
```gherkin
Scenario: Удаление устройства
  Given устройство "Лампочка в спальне" добавлено
  When пользователь выбирает "Удалить устройство"
  And подтверждает удаление
  Then устройство удаляется из дома
  And больше не отображается в списке
```

**Критерии приемки:**
- Устройство можно удалить из дома
- Требуется подтверждение удаления
- Устройство удаляется из всех комнат
- После удаления устройство больше не отображается

**Примеры:**
- ✅ Удаление устройства: подтверждение → удаление
- ✅ Удаление из комнаты не удаляет устройство из дома

**Примечания:**
- Защита от случайного удаления
- Все настройки устройства теряются при удалении

#### US-043: Изменение названия устройства [NOT MVP]
- **Как** пользователь
- **Я хочу** изменять названия устройств
- **Чтобы** называть их по-своему

#### US-044: Удаление устройства из комнаты [MVP]
- **Как** пользователь
- **Я хочу** удалять устройство из комнаты
- **Чтобы** переместить его в другую комнату

**Gherkin-сценарий:**
```gherkin
Scenario: Удаление устройства из комнаты
  Given устройство "Лампочка" привязано к комнате "Спальня"
  When пользователь выбирает "Удалить из комнаты"
  And подтверждает действие
  Then устройство удаляется из комнаты
  And остается в доме без привязки к комнате
```

**Критерии приемки:**
- Устройство можно убрать из комнаты без удаления из дома
- После удаления устройство остается в доме
- Устройство можно потом привязать к другой комнате
- Требуется подтверждение действия

**Примеры:**
- ✅ Удаление из комнаты: устройство остается в доме
- ✅ Перемещение: удаление из "Спальни" → привязка к "Гостиной"

**Примечания:**
- Полезно при переездах и перестановках
- Альтернатива прямому изменению комнаты

---

## ЭПИК 3: Управление устройствами

### Активность: Базовое управление

**Пользовательские задачи:**
- Включить/выключить устройство
- Управлять режимом энергосбережения
- Настроить яркость устройства (будущая версия)
- Изменить цвет устройства (будущая версия)

#### US-015: Включение/выключение устройства [MVP]
- **Как** пользователь
- **Я хочу** включать и выключать устройства
- **Чтобы** управлять освещением и другими приборами

**Gherkin-сценарий:**
```gherkin
Scenario: Включение устройства
  Given устройство "Лампочка" выключено
  When пользователь нажимает переключатель устройства
  Then устройство включается
  And статус изменяется на "включено"
  And устройство физически включается

Scenario: Выключение устройства
  Given устройство "Лампочка" включено
  When пользователь нажимает переключатель устройства
  Then устройство выключается
  And статус изменяется на "выключено"
```

**Критерии приемки:**
- Пользователь может включать и выключать устройство одним нажатием
- Статус устройства синхронизируется с физическим состоянием
- Время отклика устройства < 2 секунд
- Статус "недоступно" если устройство не отвечает
- Отображается визуальный индикатор статуса

**Примеры:**
- ✅ Включение лампочки: выключено → включено
- ✅ Выключение лампочки: включено → выключено
- ❌ Устройство недоступно: отображение статуса "недоступно"

**Примечания:**
- Обновление статуса в реальном времени
- Поддержка офлайн режима (статус обновится при подключении)

#### US-016: Управление режимом энергосбережения [MVP]
- **Как** пользователь
- **Я хочу** включать режим энергосбережения
- **Чтобы** экономить электроэнергию

**Gherkin-сценарий:**
```gherkin
Scenario: Включение энергосбережения
  Given устройство "Лампочка" включено
  When пользователь нажимает "Энергосбережение"
  Then режим энергосбережения активируется
  And устройство потребляет меньше энергии
  And время отклика увеличивается

Scenario: Отключение энергосбережения
  Given устройство в режиме энергосбережения
  When пользователь отключает режим
  Then устройство возвращается к обычному режиму
  And время отклика уменьшается
```

**Критерии приемки:**
- Пользователь может включить/выключить энергосбережение
- Режим доступен только для включенных устройств
- При энергосбережении потребление снижается
- Время отклика увеличивается до 5 секунд
- Визуально отображается активный режим

**Примеры:**
- ✅ Включение энергосбережения: обычный режим → энергосбережение
- ✅ Отключение энергосбережения: энергосбережение → обычный режим
- ❌ Попытка включить на выключенном устройстве: ошибка

**Примечания:**
- Уникальная функция Stets - конкурентное преимущество
- Устройство оптимизирует вспомогательные процессы
- Некоторые пользователи могут не любить увеличенное время отклика

#### US-045: Настройка яркости устройства [NOT MVP]
- **Как** пользователь
- **Я хочу** настраивать яркость лампочки
- **Чтобы** создавать комфортное освещение

#### US-046: Изменение цвета устройства [NOT MVP]
- **Как** пользователь
- **Я хочу** изменять цвет лампочки
- **Чтобы** создавать атмосферу или экспериментировать

### Активность: Групповое управление

**Пользовательские задачи:**
- Управлять всеми устройствами в комнате
- Создать группу устройств (будущая версия)

#### US-017: Управление всеми устройствами комнаты [MVP]
- **Как** пользователь
- **Я хочу** управлять всеми устройствами в комнате одной кнопкой
- **Чтобы** быстро включать/выключать освещение в помещении

**Gherkin-сценарий:**
```gherkin
Scenario: Включение всех устройств в комнате
  Given в комнате "Спальня" 3 устройства (2 включены, 1 выключено)
  When пользователь нажимает "Включить все в комнате"
  Then все устройства в комнате включаются
  And статус всех устройств изменяется на "включено"

Scenario: Выключение всех устройств в комнате
  Given в комнате "Спальня" все устройства включены
  When пользователь нажимает "Выключить все в комнате"
  Then все устройства в комнате выключаются
```

**Критерии приемки:**
- Одна кнопка управляет всеми устройствами в комнате
- Действие применяется ко всем устройствам одновременно
- Статусы всех устройств обновляются
- Работает только для устройств в комнате

**Примеры:**
- ✅ Включить все: 0 включено → все включены
- ✅ Выключить все: все включены → все выключены
- ✅ Частично включено: все приводятся к одному состоянию

**Примечания:**
- Удобно для быстрого управления освещением в комнате
- Не влияет на устройства не в комнате

#### US-047: Создание группы устройств [NOT MVP]
- **Как** пользователь
- **Я хочу** создавать группы устройств
- **Чтобы** управлять несколькими устройствами одновременно

---

## ЭПИК 4: Автоматизация

### Активность: Простые сценарии

**Пользовательские задачи:**
- Создать сценарий
- Запустить сценарий вручную
- Настроить расписание сценария
- Удалить сценарий
- Редактировать сценарий (будущая версия)
- Создать сценарий по таймеру (будущая версия)

#### US-018: Создание сценария [MVP]
- **Как** пользователь
- **Я хочу** создавать сценарии автоматизации
- **Чтобы** автоматизировать управление устройствами

**Gherkin-сценарий:**
```gherkin
Scenario: Создание сценария "Утро"
  Given пользователь на экране "Сценарии"
  When он нажимает "Создать сценарий"
  And вводит название "Утренний свет"
  And выбирает устройства "Лампочка в спальне", "Лампочка в ванной"
  And устанавливает действие "включить" для всех устройств
  And нажимает "Сохранить"
  Then сценарий создается
  And отображается в списке сценариев

Scenario: Превышение лимита сценариев
  Given в доме уже 10 сценариев
  When пользователь пытается создать 11-й сценарий
  Then отображается ошибка "Максимум 10 сценариев на дом"
```

**Критерии приемки:**
- Пользователь может создать сценарий с названием
- Можно добавить несколько устройств в сценарий
- Для каждого устройства выбирается действие (включить/выключить)
- Максимум 10 сценариев на дом
- Название сценария до 30 символов
- Сценарий отображается в списке сценариев

**Примеры:**
- ✅ Сценарий "Утро": включить лампочки в спальне и ванной
- ✅ Сценарий "Уйти": выключить все устройства
- ❌ Превышение лимита: попытка создать 11-й сценарий

**Примечания:**
- Критичная функция для продвинутых пользователей (Александра)
- Сценарии - ключевое конкурентное преимущество

#### US-019: Ручной запуск сценария [MVP]
- **Как** пользователь
- **Я хочу** запускать сценарии вручную
- **Чтобы** быстро выполнить набор действий

**Gherkin-сценарий:**
```gherkin
Scenario: Ручной запуск сценария
  Given сценарий "Утренний свет" создан
  When пользователь нажимает кнопку запуска сценария
  Then все устройства в сценарии включаются
  And отображается статус "Сценарий выполнен"
```

**Критерии приемки:**
- Пользователь может запустить сценарий вручную кнопкой
- Все устройства в сценарии выполняют действия
- Отображается статус выполнения сценария
- Если устройство недоступно, остальные выполняются
- Действия выполняются в порядке execution_order

**Примеры:**
- ✅ Запуск сценария: все устройства включаются
- ✅ Частичное выполнение: недоступное устройство пропускается
- ✅ Порядок выполнения: последовательность действий соблюдается

**Примечания:**
- Кнопка запуска на главном экране сценариев
- Удобно для быстрого управления

#### US-020: Настройка расписания сценария [MVP]
- **Как** пользователь
- **Я хочу** настраивать автоматический запуск сценариев
- **Чтобы** устройства работали по расписанию

**Gherkin-сценарий:**
```gherkin
Scenario: Настройка расписания
  Given сценарий "Утренний свет" создан
  When пользователь выбирает "Настроить расписание"
  And выбирает дни "Понедельник, Вторник, Среда, Четверг, Пятница"
  And устанавливает время "07:00"
  And устанавливает время окончания "08:00"
  And нажимает "Сохранить"
  Then сценарий будет запускаться автоматически в будни в 7:00
  And устройства будут выключаться в 8:00
```

**Критерии приемки:**
- Можно выбрать дни недели для запуска
- Можно установить время запуска сценария
- Можно установить время окончания сценария
- Если время не указано, только ручной запуск
- Время окончания опционально
- Сценарий запускается автоматически по расписанию

**Примеры:**
- ✅ Расписание: будни 07:00-08:00
- ✅ Без времени: только ручной запуск
- ✅ Без времени окончания: только запуск

**Примечания:**
- Пошаговая настройка расписания
- Время окончания - востребованная функция по данным заказчика

#### US-021: Удаление сценария [MVP]
- **Как** пользователь
- **Я хочу** удалять ненужные сценарии
- **Чтобы** поддерживать актуальный список автоматизации

**Gherkin-сценарий:**
```gherkin
Scenario: Удаление сценария
  Given сценарий "Старый сценарий" существует
  When пользователь выбирает "Удалить сценарий"
  And подтверждает удаление
  Then сценарий удаляется
  And больше не отображается в списке
```

**Критерии приемки:**
- Сценарий можно удалить из списка
- Требуется подтверждение удаления
- После удаления сценарий не запускается автоматически
- История выполнения сохраняется (если требуется)

**Примеры:**
- ✅ Удаление сценария: подтверждение → удаление
- ✅ Автозапуск прекращается после удаления

**Примечания:**
- Защита от случайного удаления

#### US-048: Редактирование сценария [NOT MVP]
- **Как** пользователь
- **Я хочу** редактировать существующий сценарий
- **Чтобы** изменять действия и расписание

#### US-049: Создание сценария по таймеру [NOT MVP]
- **Как** пользователь
- **Я хочу** создавать сценарии с таймером
- **Чтобы** отключать устройства через заданное время

---

## ЭПИК 5: Совместный доступ

### Активность: Управление доступами

**Пользовательские задачи:**
- Добавить члена семьи
- Удалить члена семьи
- Изменить роль члена семьи
- Просмотреть список участников

#### US-022: Добавление члена семьи [MVP]
- **Как** владелец дома
- **Я хочу** добавлять членов семьи к управлению домом
- **Чтобы** они могли управлять устройствами без настройки

**Gherkin-сценарий:**
```gherkin
Scenario: Добавление члена семьи
  Given пользователь является владельцем дома
  When он переходит в "Настройки дома" → "Участники"
  And нажимает "Добавить участника"
  And вводит email "wife@example.com"
  And выбирает роль "Член семьи"
  And нажимает "Пригласить"
  Then приглашение отправляется на email
  And пользователь добавляется в список участников

Scenario: Принятие приглашения
  Given пользователь получил приглашение на email
  When он переходит по ссылке в приглашении
  And авторизуется в приложении
  Then он получает доступ к дому
  And может управлять устройствами
```

**Критерии приемки:**
- Владелец может добавить участника по email
- Доступны роли: owner (владелец), member (член семьи)
- Приглашение отправляется на email
- Приглашенный получает ссылку для принятия
- После принятия участник получает доступ ко всем устройствам
- Все участники видят устройства и могут управлять

**Примеры:**
- ✅ Добавление жены: email="wife@example.com", роль="Член семьи"
- ✅ Принятие приглашения: переход по ссылке → доступ к дому
- ❌ Попытка добавить несуществующий email: ошибка

**Примечания:**
- Критичная функция для совместного проживания
- Член семьи не может изменять структуру дома
- Владелец управляет участниками

#### US-050: Удаление члена семьи [MVP]
- **Как** владелец дома
- **Я хочу** удалять членов семьи из дома
- **Чтобы** ограничить доступ

**Gherkin-сценарий:**
```gherkin
Scenario: Удаление члена семьи
  Given пользователь является владельцем дома
  And в доме есть участник "Соседка"
  When он выбирает "Удалить участника"
  And подтверждает удаление
  Then участник удаляется из дома
  And теряет доступ к управлению
```

**Критерии приемки:**
- Владелец может удалить участника
- Требуется подтверждение удаления
- После удаления участник теряет доступ к дому
- Владелец не может удалить себя

**Примеры:**
- ✅ Удаление участника: подтверждение → удаление доступа
- ❌ Попытка удалить себя: ошибка
- ✅ Дополнительный владелец может удалить первого владельца

**Примечания:**
- Защита от случайного удаления

#### US-051: Изменение роли члена семьи [MVP]
- **Как** владелец дома
- **Я хочу** изменять роли участников
- **Чтобы** управлять уровнями доступа

**Gherkin-сценарий:**
```gherkin
Scenario: Изменение роли на владельца
  Given владелец дома
  And участник "Сын" имеет роль "Член семьи"
  When владелец изменяет роль на "Владелец"
  Then роль успешно изменяется
```

**Критерии приемки:**
- Можно изменить роль участника (member ↔ owner)
- Изменение роли сохраняется немедленно
- Новый владелец получает права управления
- Бывший владелец становится членом семьи

**Примеры:**
- ✅ Повышение роли: member → owner
- ✅ Понижение роли: owner → member

**Примечания:**
- Должен оставаться хотя бы один владелец
- Нельзя понизить последнего владельца

#### US-052: Просмотр списка участников [MVP]
- **Как** владелец дома
- **Я хочу** видеть список всех участников дома
- **Чтобы** знать, кто имеет доступ

**Критерии приемки:**
- Отображается список всех участников
- Видны имя, email, роль каждого участника
- Владелец видит опции управления (добавить/удалить/изменить роль)

**Примеры:**
- ✅ Отображение: список всех участников с ролями

**Примечания:**
- Для прозрачности доступа

---

## ЭПИК 6: Уведомления и рассылки

### Активность: Связь с пользователем

**Пользовательские задачи:**
- Получать пуш-уведомления о новостях
- Получать рассылки на email
- Получать уведомления о статусе устройств

#### US-053: Пуш-уведомления о новостях [NOT MVP]
- **Как** пользователь
- **Я хочу** получать пуш-уведомления о новинках
- **Чтобы** быть в курсе обновлений

#### US-054: Email рассылки [NOT MVP]
- **Как** пользователь
- **Я хочу** получать рассылки на email
- **Чтобы** узнавать о новых продуктах

#### US-055: Уведомления о статусе устройств [NOT MVP]
- **Как** пользователь
- **Я хочу** получать уведомления о недоступных устройствах
- **Чтобы** знать о проблемах

---

## ЭПИК 7: Расширенные функции

### Активность: Добавление других устройств

#### US-056: Добавление устройств других производителей [NOT MVP]
- **Как** пользователь
- **Я хочу** добавлять устройства других производителей
- **Чтобы** управлять всем умным домом в одном приложении

#### US-057: Управление розетками [NOT MVP]
- **Как** пользователь
- **Я хочу** добавлять и управлять умными розетками
- **Чтобы** контролировать энергопотребление

#### US-058: Управление датчиками движения [NOT MVP]
- **Как** пользователь
- **Я хочу** добавлять и настраивать датчики движения
- **Чтобы** автоматизировать управление по движениям

---

## Итоговая статистика

### MVP (MUST HAVE)
- **Всего историй:** 22
- **Все с Gherkin-сценариями**
- **Все с критериями приемки, примерами и примечаниями**

### Будущие версии (SHOULD HAVE / COULD HAVE)
- **Всего историй:** 15
- **Без Gherkin-сценариев** (пока не в разработке)

### Общая статистика
- **Всего пользовательских историй:** 37
- **Эпиков:** 7
- **Активностей:** 12
- **Пользовательских задач:** 35+
- **Gherkin-сценариев для MVP:** 60+

### Детализация MVP историй
- **Аутентификация:** 6 историй
- **Организация дома:** 9 историй
- **Управление устройствами:** 2 истории
- **Автоматизация:** 4 истории
- **Совместный доступ:** 1 история

---

## Критерии готовности (Definition of Done)

Для каждой пользовательской истории MVP:
1. ✅ Функциональность реализована согласно Gherkin-сценариям
2. ✅ Все сценарии проходят автоматические тесты
3. ✅ UI соответствует дизайн-системе Stets
4. ✅ Обработаны все edge cases и ошибки
5. ✅ Функция протестирована на обеих персонах (Михаил и Алёна)
6. ✅ Производительность соответствует требованиям (< 2 сек отклик)
7. ✅ Документация обновлена

---

## Метрики успеха MVP

- **Время онбординга:** < 5 минут от установки до первого управляемого устройства
- **Успешность добавления устройства:** > 95% через QR-код, > 90% через ручной ввод
- **Время отклика устройства:** < 2 секунды в обычном режиме, < 5 секунд в энергосбережении
- **Удовлетворенность пользователей:** > 4.0/5.0 в опросе после использования MVP

---

*Документ включает все пользовательские истории, определенные на основе интервью с заказчиком и пользователями, с четким разделением на MVP и будущие версии.*
