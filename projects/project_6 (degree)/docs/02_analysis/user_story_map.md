# Карта пользовательских историй (User Story Map)

## Контекст

Карта пользовательских историй для приложения Stets Home разработана на основе анализа требований заказчика и пользователей. Структура организована по эпикам и активностям с выделением MVP-функций и детальными Gherkin-сценариями.

## Персоны пользователей

### Михаил (Новичок)
- **Возраст:** 30 лет, IT-специалист
- **Опыт:** Новичок в умном доме, боится сложности
- **Цель:** Простое управление освещением, энергосбережение

### Алёна (Эксперт)
- **Возраст:** 35 лет, фитнес-тренер
- **Опыт:** Продвинутый пользователь умного дома
- **Цель:** Автоматизация, удобное управление множеством устройств

## Структура User Story Map

### ЭПИК 1: Онбординг и аутентификация

#### Активность: Первое знакомство с приложением
- **US-001: Регистрация нового пользователя** [MVP]
  - **Как** новый пользователь
  - **Я хочу** зарегистрироваться в приложении
  - **Чтобы** получить доступ к управлению умным домом
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Успешная регистрация
    Given пользователь открыл приложение впервые
    When он нажимает "Зарегистрироваться"
    And вводит валидный email "user@example.com"
    And вводит пароль "Password123"
    And вводит имя "Михаил"
    And нажимает "Создать аккаунт"
    Then создается учетная запись пользователя
    And автоматически создается дом "Мой дом"
    And пользователь попадает на главный экран
  
  Scenario: Регистрация с невалидным паролем
    Given пользователь открыл приложение впервые
    When он вводит пароль "123"
    Then отображается ошибка "Пароль должен содержать 8-16 символов, включая строчные и прописные буквы"
  ```

- **US-002: Автосоздание первого дома** [MVP]
  - **Как** новый пользователь
  - **Я хочу** чтобы первый дом создался автоматически
  - **Чтобы** сразу начать добавлять устройства без дополнительных настроек
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Автосоздание дома при регистрации
    Given пользователь успешно зарегистрировался
    When система обрабатывает регистрацию
    Then автоматически создается дом с названием "Мой дом"
    And пользователь становится владельцем этого дома
    And дом отображается на главном экране
  ```

- **US-003: Вход в приложение** [MVP]
  - **Как** зарегистрированный пользователь
  - **Я хочу** войти в приложение
  - **Чтобы** получить доступ к своему умному дому
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Успешный вход
    Given пользователь зарегистрирован в системе
    When он вводит email "user@example.com"
    And вводит пароль "Password123"
    And нажимает "Войти"
    Then пользователь успешно авторизуется
    And отображается главный экран с его домами
  ```

#### Активность: Управление учетной записью
- **US-004: Восстановление пароля** [MVP]
  - **Как** пользователь, забывший пароль
  - **Я хочу** восстановить доступ к аккаунту
  - **Чтобы** не потерять настройки умного дома
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Восстановление пароля
    Given пользователь на экране входа
    When он нажимает "Забыли пароль?"
    And вводит email "user@example.com"
    And нажимает "Отправить"
    Then на email отправляется ссылка для сброса пароля
    And отображается сообщение "Проверьте почту"
  ```

- **US-005: Изменение email** [MVP]
  - **Как** пользователь
  - **Я хочу** изменить email в профиле
  - **Чтобы** использовать актуальный адрес для уведомлений
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Изменение email
    Given пользователь авторизован в приложении
    When он переходит в "Профиль" → "Настройки"
    And нажимает "Изменить email"
    And вводит новый email "newemail@example.com"
    And подтверждает изменение
    Then email успешно обновляется
    And на новый email отправляется подтверждение
  ```

- **US-006: Выход из приложения** [MVP]
  - **Как** пользователь
  - **Я хочу** выйти из приложения
  - **Чтобы** защитить свои данные при использовании чужого устройства
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Выход из приложения
    Given пользователь авторизован в приложении
    When он переходит в "Профиль"
    And нажимает "Выйти"
    Then пользователь разлогинивается
    And отображается экран входа
  ```

### ЭПИК 2: Организация умного дома

#### Активность: Настройка структуры дома
- **US-007: Создание комнат** [MVP]
  - **Как** пользователь
  - **Я хочу** создавать комнаты в доме
  - **Чтобы** организовать устройства по помещениям
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Создание новой комнаты
    Given пользователь на главном экране дома
    When он нажимает "Добавить комнату"
    And выбирает тип "Спальня"
    And вводит название "Главная спальня"
    And выбирает иконку "кровать"
    And нажимает "Создать"
    Then комната добавляется в список
    And отображается на главном экране
  
  Scenario: Превышение лимита комнат
    Given в доме уже 10 комнат
    When пользователь пытается добавить 11-ю комнату
    Then отображается ошибка "Максимум 10 комнат на дом"
  ```

- **US-008: Редактирование комнат** [MVP]
  - **Как** пользователь
  - **Я хочу** изменять данные комнат
  - **Чтобы** исправить ошибки или обновить информацию
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Редактирование комнаты
    Given пользователь видит список комнат
    When он нажимает на комнату "Спальня"
    And выбирает "Редактировать"
    And изменяет название на "Главная спальня"
    And изменяет тип на "Гостиная"
    And нажимает "Сохранить"
    Then изменения сохраняются
    And комната отображается с новыми данными
  ```

- **US-009: Удаление комнат** [MVP]
  - **Как** пользователь
  - **Я хочу** удалять ненужные комнаты
  - **Чтобы** поддерживать актуальную структуру дома
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Удаление пустой комнаты
    Given комната "Коридор" не содержит устройств
    When пользователь выбирает "Удалить комнату"
    And подтверждает удаление
    Then комната удаляется из списка
  
  Scenario: Удаление комнаты с устройствами
    Given комната "Спальня" содержит устройства
    When пользователь пытается удалить комнату
    Then отображается предупреждение "В комнате есть устройства. Сначала переместите их в другие комнаты"
  ```

#### Активность: Подключение устройств
- **US-010: Добавление устройства через QR-код** [MVP]
  - **Как** пользователь
  - **Я хочу** добавлять устройства сканированием QR-кода
  - **Чтобы** быстро подключить новое устройство
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Успешное добавление через QR
    Given пользователь на экране "Добавить устройство"
    When он нажимает "Сканировать QR-код"
    And сканирует валидный QR-код "123456789012"
    Then устройство добавляется в дом
    And отображается в списке устройств
    And предлагается выбрать комнату
  
  Scenario: Сканирование невалидного QR
    Given пользователь сканирует QR-код
    When QR-код содержит невалидный код "abc123"
    Then отображается ошибка "Неверный код устройства"
  ```

- **US-011: Добавление устройства вручную** [MVP]
  - **Как** пользователь
  - **Я хочу** добавлять устройства вводом кода вручную
  - **Чтобы** подключить устройство когда QR-код поврежден
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Добавление устройства вручную
    Given пользователь на экране "Добавить устройство"
    When он нажимает "Ввести код вручную"
    And вводит код "123456789012"
    And нажимает "Добавить"
    Then устройство добавляется в дом
    And отображается в списке устройств
  ```

- **US-012: Предотвращение дубликатов устройств** [MVP]
  - **Как** пользователь
  - **Я хочу** чтобы система предотвращала добавление одного устройства дважды
  - **Чтобы** избежать путаницы в управлении
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Попытка добавить существующее устройство
    Given устройство с кодом "123456789012" уже добавлено
    When пользователь пытается добавить устройство с тем же кодом
    Then отображается ошибка "Устройство уже добавлено в дом"
    And устройство не добавляется повторно
  ```

- **US-013: Привязка устройства к комнате** [MVP]
  - **Как** пользователь
  - **Я хочу** привязывать устройства к комнатам
  - **Чтобы** организовать управление по помещениям
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Привязка устройства к комнате
    Given устройство добавлено в дом
    When пользователь выбирает "Настроить устройство"
    And выбирает комнату "Спальня"
    And нажимает "Сохранить"
    Then устройство привязывается к комнате
    And отображается в списке устройств комнаты
  ```

- **US-014: Удаление устройства** [MVP]
  - **Как** пользователь
  - **Я хочу** удалять сломанные устройства
  - **Чтобы** поддерживать актуальный список устройств
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Удаление устройства
    Given устройство "Лампочка в спальне" добавлено
    When пользователь выбирает "Удалить устройство"
    And подтверждает удаление
    Then устройство удаляется из дома
    And больше не отображается в списке
  ```

### ЭПИК 3: Управление устройствами

#### Активность: Базовое управление
- **US-015: Включение/выключение устройства** [MVP]
  - **Как** пользователь
  - **Я хочу** включать и выключать устройства
  - **Чтобы** управлять освещением и другими приборами
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Включение устройства
    Given устройство "Лампочка" выключено
    When пользователь нажимает переключатель устройства
    Then устройство включается
    And статус изменяется на "включено"
    And устройство физически включается
  
  Scenario: Выключение устройства
    Given устройство "Лампочка" включено
    When пользователь нажимает переключатель устройства
    Then устройство выключается
    And статус изменяется на "выключено"
  ```

- **US-016: Управление режимом энергосбережения** [MVP]
  - **Как** пользователь
  - **Я хочу** включать режим энергосбережения
  - **Чтобы** экономить электроэнергию
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Включение энергосбережения
    Given устройство "Лампочка" включено
    When пользователь нажимает "Энергосбережение"
    Then режим энергосбережения активируется
    And устройство потребляет меньше энергии
    And время отклика увеличивается
  
  Scenario: Отключение энергосбережения
    Given устройство в режиме энергосбережения
    When пользователь отключает режим
    Then устройство возвращается к обычному режиму
    And время отклика уменьшается
  ```

#### Активность: Групповое управление
- **US-017: Управление всеми устройствами комнаты** [MVP]
  - **Как** пользователь
  - **Я хочу** управлять всеми устройствами в комнате одной кнопкой
  - **Чтобы** быстро включать/выключать освещение в помещении
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Включение всех устройств в комнате
    Given в комнате "Спальня" 3 устройства (2 включены, 1 выключено)
    When пользователь нажимает "Включить все в комнате"
    Then все устройства в комнате включаются
    And статус всех устройств изменяется на "включено"
  
  Scenario: Выключение всех устройств в комнате
    Given в комнате "Спальня" все устройства включены
    When пользователь нажимает "Выключить все в комнате"
    Then все устройства в комнате выключаются
  ```

### ЭПИК 4: Автоматизация

#### Активность: Простые сценарии
- **US-018: Создание сценария** [MVP]
  - **Как** пользователь
  - **Я хочу** создавать сценарии автоматизации
  - **Чтобы** автоматизировать управление устройствами
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Создание сценария "Утро"
    Given пользователь на экране "Сценарии"
    When он нажимает "Создать сценарий"
    And вводит название "Утренний свет"
    And выбирает устройства "Лампочка в спальне", "Лампочка в ванной"
    And устанавливает действие "включить" для всех устройств
    And нажимает "Сохранить"
    Then сценарий создается
    And отображается в списке сценариев
  
  Scenario: Превышение лимита сценариев
    Given в доме уже 10 сценариев
    When пользователь пытается создать 11-й сценарий
    Then отображается ошибка "Максимум 10 сценариев на дом"
  ```

- **US-019: Ручной запуск сценария** [MVP]
  - **Как** пользователь
  - **Я хочу** запускать сценарии вручную
  - **Чтобы** быстро выполнить набор действий
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Ручной запуск сценария
    Given сценарий "Утренний свет" создан
    When пользователь нажимает кнопку запуска сценария
    Then все устройства в сценарии включаются
    And отображается статус "Сценарий выполнен"
  ```

- **US-020: Настройка расписания сценария** [MVP]
  - **Как** пользователь
  - **Я хочу** настраивать автоматический запуск сценариев
  - **Чтобы** устройства работали по расписанию
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Настройка расписания
    Given сценарий "Утренний свет" создан
    When пользователь выбирает "Настроить расписание"
    And выбирает дни "Понедельник, Вторник, Среда, Четверг, Пятница"
    And устанавливает время "07:00"
    And устанавливает время окончания "08:00"
    And нажимает "Сохранить"
    Then сценарий будет запускаться автоматически в будни в 7:00
    And устройства будут выключаться в 8:00
  ```

- **US-021: Удаление сценария** [MVP]
  - **Как** пользователь
  - **Я хочу** удалять ненужные сценарии
  - **Чтобы** поддерживать актуальный список автоматизации
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Удаление сценария
    Given сценарий "Старый сценарий" существует
    When пользователь выбирает "Удалить сценарий"
    And подтверждает удаление
    Then сценарий удаляется
    And больше не отображается в списке
  ```

### ЭПИК 5: Совместный доступ

#### Активность: Управление доступами
- **US-022: Добавление члена семьи** [MVP]
  - **Как** владелец дома
  - **Я хочу** добавлять членов семьи к управлению домом
  - **Чтобы** они могли управлять устройствами без настройки
  
  **Gherkin-сценарий:**
  ```gherkin
  Scenario: Добавление члена семьи
    Given пользователь является владельцем дома
    When он переходит в "Настройки дома" → "Участники"
    And нажимает "Добавить участника"
    And вводит email "wife@example.com"
    And выбирает роль "Член семьи"
    And нажимает "Пригласить"
    Then приглашение отправляется на email
    And пользователь добавляется в список участников
  
  Scenario: Принятие приглашения
    Given пользователь получил приглашение на email
    When он переходит по ссылке в приглашении
    And авторизуется в приложении
    Then он получает доступ к дому
    And может управлять устройствами
  ```

## Критерии готовности (Definition of Done)

Для каждой пользовательской истории:
1. ✅ Функциональность реализована согласно Gherkin-сценариям
2. ✅ Все сценарии проходят автоматические тесты
3. ✅ UI соответствует дизайн-системе Stets
4. ✅ Обработаны все edge cases и ошибки
5. ✅ Функция протестирована на обеих персонах (Михаил и Алёна)
6. ✅ Производительность соответствует требованиям (< 2 сек отклик)
7. ✅ Документация обновлена

## Метрики успеха MVP

- **Время онбординга:** < 5 минут от установки до первого управляемого устройства
- **Успешность добавления устройства:** > 95% через QR-код, > 90% через ручной ввод
- **Время отклика устройства:** < 2 секунды в обычном режиме, < 5 секунд в энергосбережении
- **Удовлетворенность пользователей:** > 4.0/5.0 в опросе после использования MVP
