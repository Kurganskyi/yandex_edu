╔════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                   DFD LEVEL 1 - Stets Home App (нотация Гейна-Сарсона)                                       ║
╚════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

                           ┌────────────────────────────────────────────────────────┐
                           │            Система Stets Home App                       │
                           └────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                │
│   ┌──────────────┐                                                                                                            │
│   │              │   Данные регистрации, данные входа, запрос восстановления пароля                                          │
│   │              │─────────────────────────────────────────────────────────────────┐                                         │
│   │              │                                                                 │                                         │
│   │ Пользователь │   Настройки дома, приглашения участников                      │                                         │
│   │              │────────────────────────────────────────────────┐              │                                         │
│   │              │                                                ▼              │                                         │
│   │              │   Данные комнат                                            ┌───────────────────┐                       │
│   │              │───────────────────────────────────────────────┐             │ 1.0 Управлять    │                       │
│   │              │                                               ▼             │ учетной записью  │                       │
│   │              │   QR-коды/коды устройств                  ┌───────────────────┤                  │                       │
│   │              │──────────────────────────────────────────┐│                │                   │                       │
│   │              │                                          ▼▼                │                   │                       │
│   │              │   Команды управления                 ┌───────────────────┐ └───────────────────┘                       │
│   │              │──────────────────────────────────────┐│                │         │                                      │
│   │              │                                     ▼▼                │         │ Новый пользователь                    │
│   │              │   Конфигурация сценариев       ┌───────────────────┐ │         ▼                                      │
│   │              │───────────────────────────────┐│                │ │    ┌─────────────┐                               │
│   │              │                              ▼▼                │ │    │             │                               │
│   │              │   Запросы запуска сценария  ┌───────────────────┐ │    │  D1: Users  │                               │
│   │              │─────────────────────────────┐│                │ │    │             │                               │
│   │              │                            ▼▼                │ │    └─────────────┘                               │
│   │              │                        ┌───────────────────┐ │ │                                                     │
│   │              │                        │ 2.0 Управлять    │ │ │                                                     │
│   │              │                        │ домом            │ │ │                                                     │
│   │              │                        │                  │ │ │                                                     │
│   │              │                        │                  │ │ │                                                     │
│   │              │                        │                  │ │ │                                                     │
│   │              │                        │                  │ │ │                                                     │
│   │              │                        └───────────────────┘ │ │                                                     │
│   │              │                                │              │ │                                                     │
│   │              │                                │              │ │                                                     │
│   │              │                                │ Новый дом    │ │                                                     │
│   │              │                                ▼              │ │                                                     │
│   │              │                          ┌─────────────┐     │ │                                                     │
│   │              │                          │             │     │ │                                                     │
│   │              │                          │ D2: Homes   │     │ │                                                     │
│   │              │                          │             │     │ │                                                     │
│   │              │                          └─────────────┘     │ │                                                     │
│   │              │                                               │ │                                                     │
│   │              │                                │              │ │                                                     │
│   │              │                                │ Приглашения  │ │                                                     │
│   │              │                                ▼              │ │                                                     │
│   │              │                          ┌─────────────┐     │ │                                                     │
│   │              │                          │             │     │ │                                                     │
│   │              │                          │D3: User_Homes│    │ │                                                     │
│   │              │                          │             │     │ │                                                     │
│   │              │                          └─────────────┘     │ │                                                     │
│   │              │                                               │ │                                                     │
│   │              │                        ┌───────────────────┐ │ │                                                     │
│   │              │                        │ 3.0 Управлять    │ │ │                                                     │
│   │              │                        │ комнатой         │ │ │                                                     │
│   │              │                        │                  │ │ │                                                     │
│   │              │                        │                  │ │ │                                                     │
│   │              │                        └───────────────────┘ │ │                                                     │
│   │              │                                │              │ │                                                     │
│   │              │                                │ Новая комната│ │                                                     │
│   │              │                                ▼              │ │                                                     │
│   │              │                          ┌─────────────┐     │ │                                                     │
│   │              │                          │             │     │ │                                                     │
│   │              │                          │ D4: Rooms   │     │ │                                                     │
│   │              │                          │             │     │ │                                                     │
│   │              │                          └─────────────┘     │ │                                                     │
│   │              │                                               │ │                                                     │
│   │              │                                       ┌─────────────┐                                                 │
│   │              │                                       │             │                                                 │
│   │              │                                       │ D5: Icons   │                                                 │
│   │              │                                       │             │                                                 │
│   │              │                                       └─────────────┘                                                 │
│   │              │                                               ▲                                                        │
│   │              │                                               │ Чтение                                                │
│   │              │                                               │                                                        │
│   │              │                        ┌───────────────────┐ │                                                        │
│   │              │                        │ 4.0 Управлять    │ │                                                        │
│   │              │                        │ устройством      │ │                                                        │
│   │              │                        │                  │ │                                                        │
│   │              │                        │                  │ │                                                        │
│   │              │                        └───────────────────┘ │                                                        │
│   │              │                                │              │                                                        │
│   │              │                                │ Новое устройство                                                      │
│   │              │                                ▼              │                                                        │
│   │              │                          ┌─────────────┐     │                                                        │
│   │              │                          │             │     │                                                        │
│   │              │                          │ D6: Devices │     │                                                        │
│   │              │                          │             │     │                                                        │
│   │              │                          └─────────────┘     │                                                        │
│   │              │                                               │                                                        │
│   │              │                                       ┌─────────────┐                                                 │
│   │              │                                       │             │                                                 │
│   │              │                                       │D7: Device_  │                                                 │
│   │              │                                       │Models       │                                                 │
│   │              │                                       │             │                                                 │
│   │              │                                       └─────────────┘                                                 │
│   │              │                                               ▲                                                        │
│   │              │                                               │ Чтение                                                │
│   │              │                                               │                                                        │
│   │              │                        ┌───────────────────┐ │                                                        │
│   │              │                        │ 5.0 Управлять    │ │                                                        │
│   │              │                        │ сценарием        │ │                                                        │
│   │              │                        │                  │ │                                                        │
│   │              │                        │                  │ │                                                        │
│   │              │                        └───────────────────┘ │                                                        │
│   │              │                                │              │                                                        │
│   │              │                                │ Новый сценарий                                                        │
│   │              │                                ▼              │                                                        │
│   │              │                          ┌─────────────┐     │                                                        │
│   │              │                          │             │     │                                                        │
│   │              │                          │ D8: Scenario│     │                                                        │
│   │              │                          │             │     │                                                        │
│   │              │                          └─────────────┘     │                                                        │
│   │              │                                               │                                                        │
│   │              │                                │ Расписание                                                           │
│   │              │                                ▼              │                                                        │
│   │              │                          ┌─────────────┐     │                                                        │
│   │              │                          │             │     │                                                        │
│   │              │                          │D9: Scenario │     │                                                        │
│   │              │                          │Schedules    │     │                                                        │
│   │              │                          │             │     │                                                        │
│   │              │                          └─────────────┘     │                                                        │
│   │              │                                               │                                                        │
│   │              │                                │ Действия                                                             │
│   │              │                                ▼              │                                                        │
│   │              │                          ┌─────────────┐     │                                                        │
│   │              │                          │             │     │                                                        │
│   │              │                          │D10: Scenario│     │                                                        │
│   │              │                          │Actions      │     │                                                        │
│   │              │                          │             │     │                                                        │
│   │              │                          └─────────────┘     │                                                        │
│   │              │                                               │                                                        │
│   │              │ Команды выполнения                           │                                                        │
│   │              │◀───────────────────────────────────────────────┘                                                        │
│   │              │                                                                                                         │
│   │              │ Обновления статуса                                                                                      │
│   │              │◀─────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│   │              │                                                                                                         │  │
│   │              │                        ┌───────────────────┐                                                            │  │
│   │              │                        │ 6.0 Синхронизация │                                                            │  │
│   │              │                        │ с IoT             │                                                            │  │
│   │              │                        │                   │                                                            │  │
│   │              │                        └───────────────────┘                                                            │  │
│   └──────────────┘                                ▲                      │                                                │  │
│                                                    │                      │                                                │  │
│                                           Статус   │                      │ Обновления                                     │  │
│                                           устройств│                      │ статуса                                        │  │
│                                                    │                      ▼                                                │  │
│   ┌──────────────┐                                 │              ┌─────────────┐                                        │  │
│   │              │   Команды управления            │              │             │                                        │  │
│   │Умные         │◀────────────────────────────────┘              │ D6: Devices │                                        │  │
│   │устройства    │   Запросы статуса                              │             │                                        │  │
│   │Stets         │                                                └─────────────┘                                        │  │
│   │              │   Статус устройств, ошибки связи                                                                    │  │
│   │              │────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│   └──────────────┘                                                                                                         │
│                                                                                                                             │
│   ┌──────────────┐                                                                                                         │
│   │              │   Статус доставки                                                                                       │
│   │ Email        │◀──────────────────────────────────────────────────────────────────────────────────────────┐            │
│   │ Service      │                                                                                           │            │
│   │              │───────────────────────────────────────────────────────────────────────────────────────────┘            │
│   │              │   Запросы отправки (восстановление, приглашения)                                                     │
│   └──────────────┘                                                                                                         │
│                                                                                                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════
                                                    УСЛОВНЫЕ ОБОЗНАЧЕНИЯ
════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

┌──────────────┐      Процесс (Process)          ┌──────────────┐      Внешняя сущность       ╔══════════════╗   Хранилище данных
│  N.N        │      Округленный прямоугольник   │  Название    │      (External Entity)     ║   D#: Name   ║   Открытый прямоугольник
│  Название   │                                 │              │      Прямоугольник         ╚══════════════╝   с двумя линиями
└──────────────┘                                 └──────────────┘

════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

ПРОЦЕССЫ:
═════════

1.0 - Управлять учетной записью       (Аутентификация, регистрация, восстановление пароля)
2.0 - Управлять домом                 (Создание домов, управление участниками)
3.0 - Управлять комнатой              (CRUD операции с комнатами)
4.0 - Управлять устройством           (Добавление и управление устройствами)
5.0 - Управлять сценарием             (Создание и выполнение сценариев)
6.0 - Синхронизация с IoT             (Взаимодействие с физическими устройствами)

ВНЕШНИЕ СУЩНОСТИ:
═════════════════

• Пользователь         (Владелец или член семьи)
• Умные устройства     (Лампочки, розетки с энергосбережением)
• Email Service        (Уведомления и приглашения)

ХРАНИЛИЩА ДАННЫХ (10):
═══════════════════════

D1: Users              - Данные пользователей (ID, email, пароль, имя)
D2: Homes              - Данные домов (ID, название, дата создания)
D3: User_Homes         - Связи пользователей и домов с ролями
D4: Rooms              - Данные комнат (ID, home_id, название, тип, иконка)
D5: Icons              - Справочник иконок для комнат
D6: Devices            - Данные устройств (ID, код, модель, дом, комната, статус)
D7: Device_Models      - Справочник моделей устройств
D8: Scenarios          - Данные сценариев (ID, home_id, название)
D9: Scenario_Schedules - Расписания сценариев
D10: Scenario_Actions  - Действия сценариев

════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════
                                                    КЛЮЧЕВЫЕ ПОТОКИ
════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

1. РЕГИСТРАЦИЯ ПОЛЬЗОВАТЕЛЯ:
   Пользователь → Данные регистрации → 1.0 Управлять учетной записью → D1: Users

2. СОЗДАНИЕ ДОМА:
   Пользователь → Настройки дома → 2.0 Управлять домом → D2: Homes → D3: User_Homes

3. ДОБАВЛЕНИЕ УСТРОЙСТВА:
   Пользователь → QR-код → 4.0 Управлять устройством → Проверка в D7: Device_Models → Создание в D6: Devices

4. ВЫПОЛНЕНИЕ СЦЕНАРИЯ:
   5.0 Управлять сценарием → Команды выполнения → 4.0 Управлять устройством → Умные устройства →
   6.0 Синхронизация с IoT → Обновление статуса → D6: Devices → Пользователь

5. ВОССТАНОВЛЕНИЕ ПАРОЛЯ:
   Пользователь → Запрос восстановления → 1.0 Управлять учетной записью → Email Service

════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════
                                                    ОТЛИЧИЯ ОТ ДРУГОЙ МОДЕЛИ
════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

✅ ДОПОЛНИТЕЛЬНЫЕ ХРАНИЛИЩА (5 новых):
   • D3: User_Homes    - Управление участниками дома
   • D5: Icons         - Справочник иконок
   • D7: Device_Models - Справочник моделей
   • D9: Scenario_Schedules - Расписания
   • D10: Scenario_Actions  - Действия

✅ ДОПОЛНИТЕЛЬНЫЙ ПРОЦЕСС:
   • 6.0 Синхронизация с IoT - Отдельная обработка устройств

✅ ДОПОЛНИТЕЛЬНАЯ ВНЕШНЯЯ СУЩНОСТЬ:
   • Email Service - Уведомления и приглашения

✅ ЛУЧШИЕ МЕЖПРОЦЕССНЫЕ СВЯЗИ:
   • 5.0 → 4.0 (Выполнение сценария)
   • 4.0 ↔ 6.0 (IoT синхронизация)
   • 2.0 → Email (Приглашения)

════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════
